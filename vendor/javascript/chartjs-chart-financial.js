// chartjs-chart-financial@0.2.1 downloaded from https://ga.jspm.io/npm:chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.esm.js

import{BarElement as e,Chart as t,BarController as o,defaults as n}from"chart.js";import{valueOrDefault as s,isNullOrUndef as l,clipArea as a,unclipArea as i}from"chart.js/helpers";
/*!
 * @license
 * chartjs-chart-financial
 * http://chartjs.org/
 * Version: 0.2.1
 *
 * Copyright 2024 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-chart-financial/blob/master/LICENSE.md
 */
/**
 * Helper function to get the bounds of the bar regardless of the orientation
 * @param {Rectangle} bar the bar
 * @param {boolean} [useFinalPosition]
 * @return {object} bounds of the bar
 * @private
 */function getBarBounds(e,t){const{x:o,y:n,base:s,width:l,height:a}=e.getProps(["x","low","high","width","height"],t);let i,r,c,d,h;if(e.horizontal){h=a/2;i=Math.min(o,s);r=Math.max(o,s);c=n-h;d=n+h}else{h=l/2;i=o-h;r=o+h;c=Math.min(n,s);d=Math.max(n,s)}return{left:i,top:c,right:r,bottom:d}}function inRange(e,t,o,n){const s=t===null;const l=o===null;const a=!(!e||s&&l)&&getBarBounds(e,n);return a&&(s||t>=a.left&&t<=a.right)&&(l||o>=a.top&&o<=a.bottom)}class FinancialElement extends e{static defaults={backgroundColors:{up:"rgba(75, 192, 192, 0.5)",down:"rgba(255, 99, 132, 0.5)",unchanged:"rgba(201, 203, 207, 0.5)"},borderColors:{up:"rgb(75, 192, 192)",down:"rgb(255, 99, 132)",unchanged:"rgb(201, 203, 207)"}};height(){return this.base-this.y}inRange(e,t,o){return inRange(this,e,t,o)}inXRange(e,t){return inRange(this,e,null,t)}inYRange(e,t){return inRange(this,null,e,t)}getRange(e){return e==="x"?this.width/2:this.height/2}getCenterPoint(e){const{x:t,low:o,high:n}=this.getProps(["x","low","high"],e);return{x:t,y:(n+o)/2}}tooltipPosition(e){const{x:t,open:o,close:n}=this.getProps(["x","open","close"],e);return{x:t,y:(o+n)/2}}}const r=t.defaults;class OhlcElement extends FinancialElement{static id="ohlc";static defaults={...FinancialElement.defaults,lineWidth:2,armLength:null,armLengthRatio:.8};draw(e){const t=this;const{x:o,open:n,high:l,low:a,close:i}=t;const c=s(t.armLengthRatio,r.elements.ohlc.armLengthRatio);let d=s(t.armLength,r.elements.ohlc.armLength);d===null&&(d=t.width*c*.5);e.strokeStyle=i<n?s(t.options.borderColors?t.options.borderColors.up:void 0,r.elements.ohlc.borderColors.up):i>n?s(t.options.borderColors?t.options.borderColors.down:void 0,r.elements.ohlc.borderColors.down):s(t.options.borderColors?t.options.borderColors.unchanged:void 0,r.elements.ohlc.borderColors.unchanged);e.lineWidth=s(t.lineWidth,r.elements.ohlc.lineWidth);e.beginPath();e.moveTo(o,l);e.lineTo(o,a);e.moveTo(o-d,n);e.lineTo(o,n);e.moveTo(o+d,i);e.lineTo(o,i);e.stroke()}}class FinancialController extends o{static overrides={label:"",parsing:false,hover:{mode:"label"},animations:{numbers:{type:"number",properties:["x","y","base","width","open","high","low","close"]}},scales:{x:{type:"timeseries",offset:true,ticks:{major:{enabled:true},source:"data",maxRotation:0,autoSkip:true,autoSkipPadding:75,sampleSize:100}},y:{type:"linear"}},plugins:{tooltip:{intersect:false,mode:"index",callbacks:{label(e){const t=e.parsed;if(!l(t.y))return n.plugins.tooltip.callbacks.label(e);const{o:o,h:s,l:a,c:i}=t;return`O: ${o}  H: ${s}  L: ${a}  C: ${i}`}}}}};getLabelAndValue(e){const t=this;const o=t.getParsed(e);const n=t._cachedMeta.iScale.axis;const{o:s,h:l,l:a,c:i}=o;const r=`O: ${s}  H: ${l}  L: ${a}  C: ${i}`;return{label:`${t._cachedMeta.iScale.getLabelForValue(o[n])}`,value:r}}getUserBounds(e){const{min:t,max:o,minDefined:n,maxDefined:s}=e.getUserBounds();return{min:n?t:Number.NEGATIVE_INFINITY,max:s?o:Number.POSITIVE_INFINITY}}getMinMax(e){const t=this._cachedMeta;const o=t._parsed;const n=t.iScale.axis;const s=this._getOtherScale(e);const{min:l,max:a}=this.getUserBounds(s);if(o.length<2)return{min:0,max:1};if(e===t.iScale)return{min:o[0][n],max:o[o.length-1][n]};const i=o.filter((({x:e})=>e>=l&&e<a));let r=Number.POSITIVE_INFINITY;let c=Number.NEGATIVE_INFINITY;for(let e=0;e<i.length;e++){const t=i[e];r=Math.min(r,t.l);c=Math.max(c,t.h)}return{min:r,max:c}}calculateElementProperties(e,t,o,n){const s=this;const l=s._cachedMeta.vScale;const a=l.getBasePixel();const i=s._calculateBarIndexPixels(e,t,n);const r=s.chart.data.datasets[s.index].data[e];const c=l.getPixelForValue(r.o);const d=l.getPixelForValue(r.h);const h=l.getPixelForValue(r.l);const u=l.getPixelForValue(r.c);return{base:o?a:h,x:i.center,y:(h+d)/2,width:i.size,open:c,high:d,low:h,close:u}}draw(){const e=this;const t=e.chart;const o=e._cachedMeta.data;a(t.ctx,t.chartArea);for(let t=0;t<o.length;++t)o[t].draw(e._ctx);i(t.ctx)}}class OhlcController extends FinancialController{static id="ohlc";static defaults={...FinancialController.defaults,dataElementType:OhlcElement.id,datasets:{barPercentage:1,categoryPercentage:1}};updateElements(e,t,o,n){const s=n==="reset";const l=this._getRuler();const{sharedOptions:a,includeOptions:i}=this._getSharedOptions(t,n);for(let r=t;r<t+o;r++){const t=a||this.resolveDataElementOptions(r,n);const o=this.calculateElementProperties(r,l,s,t);i&&(o.options=t);this.updateElement(e[r],r,o,n)}}}class CandlestickElement extends FinancialElement{static id="candlestick";static defaults={...FinancialElement.defaults,borderWidth:1};draw(e){const t=this;const{x:o,open:l,high:a,low:i,close:r}=t;let c=t.options.borderColors;typeof c==="string"&&(c={up:c,down:c,unchanged:c});let d;if(r<l){d=s(c?c.up:void 0,n.elements.candlestick.borderColors.up);e.fillStyle=s(t.options.backgroundColors?t.options.backgroundColors.up:void 0,n.elements.candlestick.backgroundColors.up)}else if(r>l){d=s(c?c.down:void 0,n.elements.candlestick.borderColors.down);e.fillStyle=s(t.options.backgroundColors?t.options.backgroundColors.down:void 0,n.elements.candlestick.backgroundColors.down)}else{d=s(c?c.unchanged:void 0,n.elements.candlestick.borderColors.unchanged);e.fillStyle=s(t.backgroundColors?t.backgroundColors.unchanged:void 0,n.elements.candlestick.backgroundColors.unchanged)}e.lineWidth=s(t.options.borderWidth,n.elements.candlestick.borderWidth);e.strokeStyle=d;e.beginPath();e.moveTo(o,a);e.lineTo(o,Math.min(l,r));e.moveTo(o,i);e.lineTo(o,Math.max(l,r));e.stroke();e.fillRect(o-t.width/2,r,t.width,l-r);e.strokeRect(o-t.width/2,r,t.width,l-r);e.closePath()}}class CandlestickController extends FinancialController{static id="candlestick";static defaults={...FinancialController.defaults,dataElementType:CandlestickElement.id};static defaultRoutes=o.defaultRoutes;updateElements(e,t,o,n){const s=n==="reset";const l=this._getRuler();const{sharedOptions:a,includeOptions:i}=this._getSharedOptions(t,n);for(let r=t;r<t+o;r++){const t=a||this.resolveDataElementOptions(r,n);const o=this.calculateElementProperties(r,l,s,t);i&&(o.options=t);this.updateElement(e[r],r,o,n)}}}export{CandlestickController,CandlestickElement,OhlcController,OhlcElement};

