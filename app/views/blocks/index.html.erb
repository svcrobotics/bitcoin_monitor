<div class="px-4 py-8 sm:px-6 lg:px-8">
  <div class="mx-auto w-full max-w-5xl">

    <!-- Titre + intro -->
    <header class="mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight mb-2">
        Blocs Bitcoin
      </h1>
      <p class="text-gray-400 text-sm sm:text-base">
        Liste des derniers blocs vus par notre n≈ìud Bitcoin complet.  
        Cliquez sur un num√©ro de bloc pour voir le d√©tail (transactions, poids, horodatage, etc.).
      </p>
    </header>

    <% if @error.present? %>
      <div class="bg-red-900/40 border border-red-700 text-red-200 rounded-xl p-4 mb-6">
        Erreur de connexion RPC Bitcoin : <%= @error %>
      </div>
    <% else %>

      <div class="mb-6 bg-gray-900/70 border border-gray-700 rounded-2xl p-5">
        <h2 class="text-sm sm:text-base font-semibold text-gray-200 mb-4">
          üîé Recherche de blocs
        </h2>

        <%= form_with url: blocks_path, method: :get, local: true do %>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

            <!-- Bloc : Num√©ro de bloc -->
            <div class="flex flex-col">
              <label for="height"
                     class="block text-xs font-semibold text-gray-400 uppercase tracking-wide mb-1">
                Num√©ro de bloc
              </label>

              <%= number_field_tag :height,
                                   params[:height],
                                   min: 0,
                                   placeholder: "ex : 927896",
                                   class: "w-full rounded-lg bg-gray-800 border border-gray-700
                                           px-3 py-2 text-sm text-gray-100
                                           focus:outline-none focus:ring-2
                                           focus:ring-violet-500 focus:border-violet-500" %>

              <p class="mt-1 text-[11px] text-gray-500 leading-snug">
                Recherche directe par hauteur (0 = gen√®se).
              </p>
            </div>

            <!-- Bloc : Date -->
            <div class="flex flex-col">
              <label for="day"
                     class="block text-xs font-semibold text-gray-400 uppercase tracking-wide mb-1">
                Date
              </label>

              <%= date_field_tag :day,
                                 params[:day],
                                 class: "w-full rounded-lg bg-gray-800 border border-gray-700
                                         px-3 py-2 text-sm text-gray-100
                                         focus:outline-none focus:ring-2
                                         focus:ring-violet-500 focus:border-violet-500" %>

              <p class="mt-1 text-[11px] text-gray-500 leading-snug">
                Blocs min√©s ce jour-l√† (heure de Paris).
              </p>
            </div>

            <!-- Actions -->
            <div class="flex flex-col">
              <!-- label fant√¥me pour alignement -->
              <span class="block text-xs font-semibold text-transparent uppercase tracking-wide mb-1">
                Actions
              </span>

              <div class="flex flex-col sm:flex-row gap-2">
                <%= submit_tag "Rechercher",
                               class: "inline-flex items-center justify-center
                                       px-4 py-2 rounded-lg
                                       bg-violet-600 hover:bg-violet-500
                                       text-sm font-semibold text-white
                                       shadow transition" %>

                <%= link_to "R√©initialiser",
                            blocks_path,
                            class: "inline-flex items-center justify-center
                                    px-4 py-2 rounded-lg
                                    bg-gray-800 hover:bg-gray-700
                                    text-sm font-semibold text-gray-100
                                    border border-gray-600 transition" %>
              </div>

              <!-- helper fant√¥me -->
              <p class="mt-1 text-[11px] text-transparent">.</p>
            </div>

          </div>
        <% end %>
      </div>

      <!-- Carte principale, m√™me style que dans le dashboard -->
      <section class="bg-gray-800/80 border border-gray-700 rounded-2xl p-4 sm:p-6 shadow-xl w-full max-w-full">
        <div class="flex items-center justify-between gap-3 mb-4">
          <h2 class="text-lg sm:text-2xl font-semibold">
            Derniers blocs min√©s
          </h2>

          <!-- Info pagination -->
          <div class="text-xs sm:text-sm text-gray-400">
            Page <span class="font-semibold text-gray-200"><%= @page %></span>
          </div>
        </div>

        <p class="text-gray-300 text-sm leading-relaxed mb-4">
          Chaque ligne repr√©sente un bloc Bitcoin : 
          <span class="font-semibold">hauteur</span>,
          <span class="font-semibold">hash</span>,
          <span class="font-semibold">date</span>,
          <span class="font-semibold">nombre de transactions</span>,
          <span class="font-semibold">taille</span> et 
          <span class="font-semibold">poids</span>.
          Les hashes sont raccourcis sous la forme 
          <code class="font-mono text-xs bg-gray-900 px-1 py-0.5 rounded">0‚Ä¶xxxxxxxx</code>
          pour rester lisibles, mais le hash complet reste disponible dans la page de d√©tail.
        </p>

        <!-- Carte contenant le tableau principal -->
        <div class="mt-4 bg-gray-900/70 border border-gray-700 rounded-xl p-3 sm:p-4 w-full max-w-full">
          <% if @blocks.any? %>
            <div class="w-full overflow-x-auto">
              <table class="min-w-[800px] border-colapse text-sm text-gray-200">
                <thead>
                  <tr class="bg-gray-800/50 border-b border-gray-700 text-gray-300">
                    <th class="px-3 py-2 text-left border-r border-gray-700">
                      Bloc
                    </th>
                    <th class="px-3 py-2 text-left border-r border-gray-700">
                      Hash
                    </th>
                    <th class="px-3 py-2 text-left border-r border-gray-700">
                      Date / heure
                    </th>
                    <th class="px-3 py-2 text-right border-r border-gray-700">
                      Tx
                    </th>
                    <th class="px-3 py-2 text-right border-r border-gray-700">
                      Taille (octets)
                    </th>
                    <th class="px-3 py-2 text-right">
                      Poids (WU)
                    </th>
                    <th class="px-4 py-2 text-right">
                      BRC-20
                    </th>
                  </tr>
                </thead>

                <tbody>
                  <% @blocks.each_with_index do |b, idx| %>
                    <tr class="<%= idx.odd? ? 'bg-gray-800/20' : 'bg-gray-800/10' %> border-b border-gray-800">
                      <!-- Hauteur (cliquable) -->
                      <td class="px-4 py-2 border-r border-gray-700 whitespace-nowrap">
                        <%= link_to b[:height],
                                    block_path(b[:height]),
                                    class: "text-violet-300 hover:text-violet-200 font-semibold" %>
                      </td>

                      <!-- Hash raccourci -->
                      <td class="px-3 py-2 font-mono text-xs whitespace-nowrap">
                        <span 
                          title="<%= b[:hash] %>"
                          class="cursor-help underline decoration-dotted"
                        >
                          <%= short_hash(b[:hash]) %>
                        </span>
                      </td>

                      <!-- Date / heure -->
                      <td class="px-4 py-2 text-xs sm:text-sm border-r border-gray-700 whitespace-nowrap">
                        <%= l b[:time], format: :long %>
                      </td>

                      <!-- Nombre de transactions -->
                      <td class="px-4 py-2 text-right border-r border-gray-700">
                        <%= b[:tx_count] %>
                      </td>

                      <!-- Taille -->
                      <td class="px-4 py-2 text-right border-r border-gray-700">
                        <%= number_with_delimiter(b[:size_bytes]) %>
                      </td>

                      <!-- Poids -->
                      <td class="px-4 py-2 text-right">
                        <%= number_with_delimiter(b[:weight]) %>
                      </td>

                      <!-- Op√©rations BRC-20 -->
                      <td class="px-4 py-2 text-right">
                        <% if b[:brc20_scanned] %>
                          <% ops = b[:brc20_ops_count].to_i %>
                          <% if ops > 0 %>
                            <span class="inline-flex items-center gap-1 text-emerald-300 font-semibold">
                              <span class="inline-block w-2 h-2 rounded-full bg-emerald-400"></span>
                              
                            </span>
                          <% else %>
                            <span class="inline-flex items-center gap-1 text-gray-400 text-xs">
                              <span class="inline-block w-2 h-2 rounded-full bg-gray-500"></span>
                              
                            </span>
                          <% end %>
                        <% else %>
                          <span class="inline-flex items-center gap-1 text-amber-300 text-xs">
                            <span class="text-gray-500">‚Äî</span>
                          </span>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <p class="text-gray-400 text-sm">
              Aucun bloc n‚Äôa pu √™tre charg√© depuis le n≈ìud Bitcoin.
            </p>
          <% end %>
        </div>

        <!-- Pagination simple en bas -->
        <div class="mt-4 flex items-center justify-between text-xs sm:text-sm text-gray-300">
          <div>
            Page <span class="font-semibold"><%= @page %></span>
          </div>

          <div class="flex items-center gap-2">
            <% if @page > 1 %>
              <%= link_to "‚Üê Page pr√©c√©dente",
                          blocks_path(page: @page - 1),
                          class: "px-3 py-1 rounded-lg border border-gray-600 bg-gray-900/70 hover:bg-gray-800 transition" %>
            <% end %>

            <% if @has_next_page %>
              <%= link_to "Page suivante ‚Üí",
                          blocks_path(page: @page + 1),
                          class: "px-3 py-1 rounded-lg border border-violet-500/70 bg-violet-600/20 text-violet-100 hover:bg-violet-600/30 transition" %>
            <% end %>
          </div>
        </div>
      </section>
    <% end %>

    <!-- Lien retour dashboard -->
    <footer class="mt-6 text-xs sm:text-sm text-gray-500">
      <%= link_to "‚Üê Retour au dashboard Bitcoin Monitor", 
                  root_path,
                  class: "text-violet-300 hover:text-violet-200" %>
    </footer>
  </div>
</div>
