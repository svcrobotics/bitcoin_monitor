<%# locals: active_position:, sell_now:, combo_series: %>
<% return unless active_position.present? %>

<section class="mt-6 bg-gray-900/40 border border-gray-800 rounded-2xl p-4 sm:p-5">
  <div class="flex items-start justify-between gap-3 mb-3">
    <div class="min-w-0">
      <h2 class="text-sm uppercase tracking-wide text-gray-500">Position active</h2>
      <p class="text-sm text-gray-400 mt-1">
        Achat <span class="font-mono text-gray-200"><%= active_position.buy_day %></span> ·
        BTC <span class="font-mono text-gray-200"><%= active_position.btc_amount %></span>
      </p>
    </div>

    <%= link_to "Voir", active_position,
      class: "rounded-xl px-3 py-2 bg-gray-900/60 border border-gray-700/60 text-gray-200
              hover:bg-gray-800 hover:border-gray-600 transition text-sm font-semibold" %>
  </div>

  <div class="space-y-4">
    <% if sell_now.present? %>
      <%= render "dashboard/sell_now", sell_now: sell_now, active_position: active_position %>
    <% end %>

    <% if combo_series.present? %>
      <%= render "trade_simulations/curve_chart", combo_series: combo_series %>
    <% else %>
      <p class="text-sm text-gray-400">Pas de données (points non générés).</p>
    <% end %>
  </div>
</section>

<%= render "dashboard/sell_decision", decision: @sell_decision if @sell_decision.present? %>

<%= render "dashboard/buy_now", decision: @buy_decision if @buy_decision.present? %>