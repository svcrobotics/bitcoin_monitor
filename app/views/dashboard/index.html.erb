<div class="px-4 py-8 sm:px-6 lg:px-8">
  <div class="mx-auto w-full max-w-5xl">
    <!-- Header -->
    <header class="mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold tracking-tight mb-2">
        Bitcoin Monitor
      </h1>

      <section class="mt-6 bg-gray-800/80 border border-gray-700 rounded-2xl p-4 sm:p-6 lg:p-8 shadow-xl">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">

          <%= link_to blocks_path,
            class: "group w-full inline-flex items-center justify-between gap-3 rounded-xl
                    px-4 py-3 sm:px-4 sm:py-3
                    bg-gray-900/70 border border-violet-500/60 text-violet-200
                    hover:bg-violet-600/20 hover:border-violet-400 hover:text-violet-100 transition" do %>
            <span class="text-xl">üì¶</span>
            <span class="flex-1 font-semibold text-sm sm:text-[13px] leading-tight">
              Explorer les blocs
            </span>
            <span class="text-gray-400 group-hover:text-violet-200 transition">‚Ä∫</span>
          <% end %>

          <%= link_to whale_alerts_path,
            class: "group w-full inline-flex items-center justify-between gap-3 rounded-xl
                    px-4 py-3
                    bg-gray-900/70 border border-pink-500/60 text-pink-200
                    hover:bg-pink-600/20 hover:border-pink-400 hover:text-pink-100 transition" do %>
            <span class="text-xl">üêã</span>

            <span class="flex-1 font-semibold text-sm sm:text-[13px] leading-tight">
              Whale Alerts
            </span>

            <span class="text-gray-400 group-hover:text-pink-200 transition">‚Ä∫</span>
          <% end %>

          <%= link_to brc20_path,
            class: "group w-full inline-flex items-center justify-between gap-3 rounded-xl
                    px-4 py-3
                    bg-gray-900/70 border border-emerald-500/60 text-emerald-200
                    hover:bg-emerald-600/20 hover:border-emerald-400 hover:text-emerald-100 transition" do %>
            <span class="text-xl">ü™ô</span>
            <span class="flex-1 font-semibold text-sm sm:text-[13px] leading-tight">
              Analyse BRC-20
            </span>
            <span class="text-gray-400 group-hover:text-emerald-200 transition">‚Ä∫</span>
          <% end %>

          <%= link_to runes_path,
            class: "group w-full inline-flex items-center justify-between gap-3 rounded-xl
                    px-4 py-3
                    bg-gray-900/70 border border-blue-500/60 text-blue-200
                    hover:bg-blue-600/20 hover:border-blue-400 hover:text-blue-100 transition" do %>
            <span class="text-xl">‚õìÔ∏è</span>
            <span class="flex-1 font-semibold text-sm sm:text-[13px] leading-tight">
              Analyse Runes
            </span>
            <span class="text-gray-400 group-hover:text-blue-200 transition">‚Ä∫</span>
          <% end %>

          <%= link_to feature_requests_path,
            class: "group w-full inline-flex items-center justify-between gap-3 rounded-xl
                    px-4 py-3
                    bg-gray-900/70 border border-yellow-500/60 text-yellow-200
                    hover:bg-yellow-600/20 hover:border-yellow-400 hover:text-yellow-100 transition" do %>
            <span class="text-xl">üí°</span>
            <span class="flex-1 font-semibold text-sm sm:text-[13px] leading-tight">
              Id√©es & am√©liorations
            </span>
            <span class="text-gray-400 group-hover:text-yellow-200 transition">‚Ä∫</span>
          <% end %>

          <%= link_to vaults_path,
            class: "group w-full inline-flex items-center justify-between gap-3 rounded-xl
                    px-4 py-3
                    bg-gray-900/70 border border-orange-500/60 text-orange-200
                    hover:bg-orange-600/20 hover:border-orange-400 hover:text-orange-100 transition" do %>
            <span class="text-xl">üîê</span>
            <span class="flex-1 font-semibold text-sm sm:text-[13px] leading-tight">
              P2WSH Wallets
            </span>
            <span class="text-gray-400 group-hover:text-orange-200 transition">‚Ä∫</span>
          <% end %>

          <%= link_to guides_path,
                class: "group w-full inline-flex items-center justify-between gap-3 rounded-xl
                        px-4 py-3
                        bg-gray-900/70 border border-blue-500/60 text-blue-200
                        hover:bg-blue-600/20 hover:border-blue-400 hover:text-blue-100 transition" do %>
            <span class="text-xl">üìò</span>

            <span class="flex-1 font-semibold text-sm sm:text-[13px] leading-tight">
              Guides & aide (Bitcoin Monitor)
            </span>

            <span class="text-gray-400 group-hover:text-blue-200 transition">‚Ä∫</span>
          <% end %>

        </div>
      </section>
    </header>

    <% if @error %>
      <div class="bg-red-900/40 border border-red-700 text-red-200 rounded-xl p-4 mt-4">
        Erreur de connexion RPC Bitcoin : <%= @error %>
      </div>
    <% else %>

      <!-- √âTAT DE LA BLOCKCHAIN -->
      <section class="mt-6 bg-gray-800/80 border border-gray-700 rounded-2xl p-6 sm:p-8 shadow-xl">
        <h2 class="text-xl sm:text-2xl font-semibold mb-4">√âtat de la blockchain</h2>

        <div class="grid gap-4 sm:grid-cols-2">
          <div>
            <p class="text-gray-400 text-sm uppercase tracking-wide mb-1">R√©seau</p>
            <p class="text-lg text-gray-100 font-semibold"><%= network_name(@blockchain["chain"]) %></p>
          </div>

          <div>
            <p class="text-gray-400 text-sm uppercase tracking-wide mb-1">Bloc actuel</p>
            <p class="text-lg text-gray-100 font-semibold"><%= @blockchain["blocks"] %></p>
          </div>

          <div>
            <p class="text-gray-400 text-sm uppercase tracking-wide mb-1">Headers</p>
            <p class="text-lg text-gray-100 font-semibold"><%= @blockchain["headers"] %></p>
          </div>

          <div>
            <p class="text-gray-400 text-sm uppercase tracking-wide mb-1">Progression</p>
            <p class="text-lg text-gray-100 font-semibold">
              <%= (@blockchain["verificationprogress"].to_f * 100).round(4) %> %
            </p>
          </div>
        </div>
      </section>

      <!-- MEMPOOL -->
      <section class="mt-6 bg-gray-800/80 border border-gray-700 rounded-2xl p-6 sm:p-8 shadow-xl">
        <h2 class="text-xl sm:text-2xl font-semibold mb-4">Mempool</h2>

        <div class="grid gap-4 sm:grid-cols-2">

          <div>
            <p class="text-gray-400 text-sm uppercase tracking-wide mb-1">Transactions en attente</p>
            <p class="text-lg text-gray-100 font-semibold"><%= @mempool["size"] %></p>
          </div>

          <div>
            <p class="text-gray-400 text-sm uppercase tracking-wide mb-1">Taille totale</p>
            <p class="text-lg font-semibold"><%= mempool_size_badge(@mempool["bytes"].to_i) %></p>
          </div>

          <div>
            <p class="text-gray-400 text-sm uppercase tracking-wide mb-1">Frais min. mempool</p>
            <% minfee = @mempool["mempoolminfee"].to_f %>
            <% min_sat_vb = (minfee * 100_000_000 / 1000).round %>
            <p class="text-lg text-gray-100 font-semibold"><%= mempool_minfee_badge(min_sat_vb) %></p>
          </div>
        </div>
      </section>

      <!-- LIGHTNING -->
      <section class="mt-6 bg-gray-800/80 border border-gray-700 rounded-2xl p-6 sm:p-8 shadow-xl">
        <h2 class="text-xl sm:text-2xl font-semibold mb-4">
          Lightning Network
        </h2>

        <% if @lightning_status && @lightning_status[:enabled] %>
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
            <div>
              <p class="text-sm text-gray-300">
                N≈ìud Lightning :
                <span class="inline-flex items-center gap-1 font-semibold text-green-300">
                  En ligne
                </span>
              </p>
              <p class="text-xs text-gray-400">
                Alias : <strong><%= @lightning_status[:alias] || "Inconnu" %></strong><br>
                Pubkey : 
                <% if @lightning_status[:pubkey].present? %>
                  <span class="font-mono text-[11px]">
                    <%= @lightning_status[:pubkey][0, 16] %>‚Ä¶
                  </span>
                <% else %>
                  <span class="text-gray-500">non disponible</span>
                <% end %>
              </p>
            </div>

            <div class="text-xs text-gray-400">
              <p>Peers connect√©s : <strong><%= @lightning_status[:num_peers] %></strong></p>
              <p>Canaux : <strong><%= @lightning_status[:active_channels] %></strong> actifs /
                 <strong><%= @lightning_status[:num_channels] %></strong> au total</p>
            </div>
          </div>

          <div class="grid gap-4 sm:grid-cols-2 mt-2">
            <div class="bg-gray-900/70 border border-gray-700 rounded-xl p-4">
              <p class="text-xs uppercase tracking-wide text-gray-400 mb-1">
                Capacit√© totale
              </p>
              <p class="text-lg font-semibold text-gray-100">
                <%= @lightning_status[:capacity_sat] %> sats
              </p>
              <p class="text-xs text-gray-400 mt-1">
                Somme des capacit√©s de tous les canaux ouverts.
              </p>
            </div>

            <div class="bg-gray-900/70 border border-gray-700 rounded-xl p-4">
              <p class="text-xs uppercase tracking-wide text-gray-400 mb-1">
                Solde local / remote
              </p>
              <p class="text-lg font-semibold text-gray-100">
                <%= @lightning_status[:local_balance_sat] %> / <%= @lightning_status[:remote_balance_sat] %> sats
              </p>
              <p class="text-xs text-gray-400 mt-1">
                Local = liquidit√© pour envoyer ‚Ä¢ Remote = liquidit√© pour recevoir.
              </p>
            </div>
          </div>

          <div class="mt-4 bg-gray-900/70 border border-gray-700 rounded-xl p-4">
            <h3 class="text-sm font-semibold text-gray-300 uppercase tracking-wide mb-1">
              Synchronisation
            </h3>
            <p class="text-sm text-gray-200">
              Cha√Æne Bitcoin :
              <% if @lightning_status[:synced_to_chain] %>
                <span class="text-emerald-300 font-semibold">synchro OK</span>
              <% else %>
                <span class="text-yellow-300 font-semibold">en rattrapage‚Ä¶</span>
              <% end %>
              <br>
              Graphe Lightning :
              <% if @lightning_status[:synced_to_graph] %>
                <span class="text-emerald-300 font-semibold">synchro OK</span>
              <% else %>
                <span class="text-yellow-300 font-semibold">en cours de mise √† jour‚Ä¶</span>
              <% end %>
            </p>
          </div>
        <% else %>
          <p class="text-sm text-gray-300 mb-2">
            N≈ìud Lightning :
            <span class="inline-flex items-center gap-1 font-semibold text-red-300">
              Indisponible
            </span>
          </p>
          <% if @lightning_status && @lightning_status[:error].present? %>
            <p class="text-xs text-gray-400">
              D√©tail : <%= @lightning_status[:error] %>
            </p>
          <% else %>
            <p class="text-xs text-gray-400">
              Configurez les variables <code class="font-mono">LND_REST_URL</code> et
              <code class="font-mono">LND_MACAROON_HEX</code> pour activer le suivi Lightning.
            </p>
          <% end %>
        <% end %>
      </section>

      <!-- RUNES -->
      <section class="mt-6 bg-gray-800/80 border border-gray-700 rounded-2xl p-6 shadow-xl">
        <h3 class="text-lg sm:text-xl font-semibold text-gray-100 mb-2">
          Runes (aper√ßu rapide)
        </h3>

        <%= link_to "Voir la page Runes ‚Üí",
                    runes_path,
                    class: "inline-flex items-center gap-2 text-sm text-indigo-400 hover:text-indigo-300" %>
      </section>

      <!-- CARTE SYNTH√âTIQUE DU SCAN BRC-20 -->
      <section class="mt-6 bg-gray-800/80 border border-gray-700 rounded-2xl p-6 shadow-xl">
        <h2 class="text-lg sm:text-xl font-semibold text-gray-100 mb-2">
          R√©sum√© BRC-20
        </h2>

        <% if @brc20_scan_stats.present? %>
          <% if @brc20_scan_done %>
            <p class="text-gray-200 mb-2">
              Scan BRC-20 :
              <span class="inline-flex items-center gap-1 font-semibold text-green-300">
                Synchronis√©
              </span>
            </p>
          <% else %>
            <p class="text-gray-200 mb-2">
              Scan BRC-20 :
              <span class="inline-flex items-center gap-1 font-semibold text-red-400">
                En cours‚Ä¶
              </span>
            </p>
          <% end %>

          <% if @brc20_last_sync_run %>
            <p class="text-xs text-gray-400">
              Derni√®re mise √† jour : <%= l @brc20_last_sync_run %>
            </p>
          <% end %>

        <% else %>
          <p class="text-xs text-gray-400">Aucune donn√©e BRC-20 disponible.</p>
        <% end %>

        <div class="mt-3">
          <%= link_to "Voir l‚Äôanalyse d√©taill√©e ‚Üí",
                      brc20_path,
                      class: "text-sm text-indigo-400 hover:text-indigo-300" %>
        </div>
      </section>
      
      <!-- CENTRE REGLES ET RECOMMENDATIONS -->
      <section class="mt-8 bg-gray-800/80 border border-gray-700 rounded-2xl p-6 sm:p-8 shadow-xl">
        <h2 class="text-xl sm:text-2xl font-semibold mb-4">
          Centre de r√®gles & recommandations (V1)
        </h2>

        <% if @monitoring_rules.present? %>
          <div class="space-y-3">
            <% @monitoring_rules.each do |rule| %>
              <% level = rule[:level] || :info %>
              <% scope = rule[:scope] || :general %>

              <% badge_classes =
                   case level
                   when :critical then "bg-red-900/70 border-red-500/70 text-red-100"
                   when :warning  then "bg-yellow-900/70 border-yellow-500/70 text-yellow-100"
                   else                "bg-emerald-900/70 border-emerald-500/70 text-emerald-100"
                   end
              %>

              <div class="bg-gray-900/70 border border-gray-700 rounded-xl p-4">
                <div class="flex flex-wrap items-center justify-between gap-2 mb-1">
                  <div class="flex items-center gap-2">
                    <span class="text-xs uppercase tracking-wide text-gray-400">
                      <%= scope.to_s.upcase %>
                    </span>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full border text-[11px] <%= badge_classes %>">
                      <%= level.to_s.upcase %>
                    </span>
                  </div>
                </div>

                <h3 class="text-sm font-semibold text-gray-100 mb-1">
                  <%= rule[:title] %>
                </h3>

                <p class="text-sm text-gray-200 mb-1">
                  <%= rule[:message] %>
                </p>

                <% if rule[:hint].present? %>
                  <p class="text-xs text-gray-400 mt-1">
                    <span class="font-semibold">Suggestion :</span> <%= rule[:hint] %>
                  </p>
                <% end %>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-sm text-gray-300">
            Aucune alerte particuli√®re pour le moment. Les indicateurs sont dans une zone normale.
          </p>
        <% end %>
      </section>

    <% end %>

    <footer class="mt-10 text-center text-gray-500 text-xs sm:text-sm">
      Projet auto-h√©berg√© ‚Ä¢ Royan üá´üá∑ ‚Ä¢ Version 0.8 ‚Äî UI √©pur√©e ‚Ä¢ svcrobotics@gmail.com
    </footer>

  </div>
</div>
