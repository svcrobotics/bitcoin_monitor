<%# locals: monitoring_rules: %>

<section class="mt-8 bg-gray-900/40 border border-gray-800 rounded-2xl p-5 sm:p-6">
  <div class="flex items-start justify-between gap-3">
    <div>
      <h2 class="text-lg sm:text-xl font-semibold text-gray-100">Centre de r√®gles & recommandations</h2>

      <% if monitoring_rules.present? %>
        <% critical_count = monitoring_rules.count { |r| r[:level] == :critical } %>
        <% warning_count  = monitoring_rules.count { |r| r[:level] == :warning } %>

        <p class="text-xs text-gray-500 mt-1">
          <%= monitoring_rules.size %> r√®gle(s)
          <% if critical_count > 0 %>
            ‚Ä¢ <span class="text-red-400 font-semibold"><%= critical_count %> critique</span>
          <% end %>
          <% if warning_count > 0 %>
            ‚Ä¢ <span class="text-yellow-400 font-semibold"><%= warning_count %> avertissement</span>
          <% end %>
        </p>
      <% else %>
        <p class="text-xs text-gray-500 mt-1">Aucune r√®gle active actuellement</p>
      <% end %>
    </div>

    <div data-controller="toggle" class="shrink-0">
      <button type="button"
              data-action="toggle#toggle"
              class="inline-flex items-center gap-2 rounded-xl px-3 py-2
                     bg-gray-900/60 border border-gray-700 text-gray-200
                     hover:bg-gray-800 hover:border-gray-600 transition text-sm">
        <span class="text-lg">üìã</span>
        <span>Afficher / masquer</span>
      </button>

      <div data-toggle-target="content" class="hidden mt-4 space-y-3">
        <% if monitoring_rules.present? %>
          <% monitoring_rules.first(8).each do |rule| %>
            <% level = rule[:level] || :info %>
            <% scope = rule[:scope] || :general %>

            <div class="bg-gray-900/70 border border-gray-700 rounded-xl p-4">
              <div class="flex flex-wrap items-center justify-between gap-2 mb-1">
                <div class="flex items-center gap-2">
                  <span class="text-xs uppercase tracking-wide text-gray-400"><%= scope.to_s.upcase %></span>
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full border text-[11px] <%= level_badge_classes(level) %>">
                    <%= level.to_s.upcase %>
                  </span>
                </div>
              </div>

              <h3 class="text-sm font-semibold text-gray-100 mb-1"><%= rule[:title] %></h3>
              <p class="text-sm text-gray-200 mb-1"><%= rule[:message] %></p>

              <% if rule[:hint].present? %>
                <p class="text-xs text-gray-400 mt-1">
                  <span class="font-semibold">Suggestion :</span> <%= rule[:hint] %>
                </p>
              <% end %>
            </div>
          <% end %>

          <% if monitoring_rules.size > 8 %>
            <p class="text-xs text-gray-500 italic">Affichage limit√© √† 8 r√®gles pour garder la lisibilit√©.</p>
          <% end %>
        <% else %>
          <p class="text-sm text-gray-300">
            Aucune alerte particuli√®re pour le moment. Les indicateurs sont dans une zone normale.
          </p>
        <% end %>
      </div>
    </div>
  </div>
</section>
