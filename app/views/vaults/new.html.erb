<!-- app/views/vaults/new.html.erb -->
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

  <h1 class="text-2xl sm:text-3xl font-bold text-gray-100 mb-6">
    Importer un wallet Multisig (Sparrow → Bitcoin Monitor)
  </h1>

  <p class="text-sm text-gray-400 mb-8 leading-relaxed">
    Tu crées ton wallet <strong>2-of-2 (Ledger A + Ledger B)</strong> dans <strong>Sparrow</strong>.
    Ensuite tu copies <strong>les descriptors Bitcoin Core</strong> :
    <br><br>
    • <strong>Receive</strong> : branche réception <span class="font-mono text-xs">/0/*</span><br>
    • <strong>Change</strong> : branche change <span class="font-mono text-xs">/1/*</span><br>
    <br>
    Une fois importé, Bitcoin Monitor peut :
    <br>
    • suivre tout le wallet (receive + change) <br>
    • scanner UTXOs / soldes / historique <br>
    • détecter des anomalies (plus tard) <br>
    • générer une PSBT (que tu feras signer dans Sparrow)
  </p>

  <% if @vault.errors.any? %>
    <div class="mb-6 bg-red-900/40 border border-red-700 rounded-xl p-4">
      <h2 class="text-sm font-semibold text-red-200 mb-2">
        ⚠️ Impossible d’importer le wallet, vérifie :
      </h2>
      <ul class="text-xs text-red-200 list-disc list-inside space-y-1">
        <% @vault.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with model: @vault, local: true, class: "space-y-8" do |f| %>

    <!-- PARAMÈTRES -->
    <div class="bg-gray-900 border border-gray-800 rounded-xl p-6 space-y-4">
      <h2 class="text-lg font-semibold text-gray-100 mb-2">Paramètres</h2>

      <div>
        <%= f.label :label, "Nom", class: "block text-sm text-gray-300 mb-1" %>
        <%= f.text_field :label,
              class: "w-full rounded-md bg-gray-800 border border-gray-700 text-gray-100 px-3 py-2 text-sm",
              placeholder: "Ex : Vault multisig A+B (Sparrow)" %>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <%= f.label :network, "Réseau", class: "block text-sm text-gray-300 mb-1" %>
          <%= f.select :network,
                [["Mainnet", "mainnet"], ["Testnet", "testnet"], ["Regtest", "regtest"], ["Signet", "signet"]],
                {},
                class: "w-full rounded-md bg-gray-800 border border-gray-700 text-gray-100 px-3 py-2 text-sm" %>
          <p class="text-[11px] text-gray-500 mt-1">
            Mets exactement le même réseau que dans Sparrow.
          </p>
        </div>

        <div>
          <%= f.label :status, "Statut", class: "block text-sm text-gray-300 mb-1" %>
          <%= f.select :status,
                [["Brouillon", "draft"], ["Actif", "active"]],
                {},
                class: "w-full rounded-md bg-gray-800 border border-gray-700 text-gray-100 px-3 py-2 text-sm" %>
          <p class="text-[11px] text-gray-500 mt-1">
            Astuce : laisse “Brouillon” tant que l’import watch-only n’est pas fait.
          </p>
        </div>
      </div>

      <div>
        <%= f.label :scan_range, "Scan range (gap / profondeur)", class: "block text-sm text-gray-300 mb-1" %>
        <%= f.number_field :scan_range,
              min: 0,
              class: "w-full rounded-md bg-gray-800 border border-gray-700 text-gray-100 px-3 py-2 text-sm",
              placeholder: "200" %>
        <p class="text-[11px] text-gray-500 mt-1">
          Nombre d’index à dériver pour <span class="font-mono">/0/*</span> et <span class="font-mono">/1/*</span>.
          (200 = bon défaut)
        </p>
      </div>
    </div>

    <!-- DESCRIPTORS -->
    <div class="bg-gray-900 border border-gray-800 rounded-xl p-6 space-y-4">
      <h2 class="text-lg font-semibold text-gray-100 mb-2">Descriptors (Bitcoin Core)</h2>

      <div class="bg-gray-800/50 border border-gray-700 rounded-lg p-4">
        <p class="text-xs text-gray-300 leading-relaxed">
          Dans Sparrow, récupère les strings “Bitcoin Core descriptor”.
          <br>
          Tu dois avoir 2 lignes distinctes :
          <br>
          • Receive : <span class="font-mono">.../0/*))#checksum</span><br>
          • Change : <span class="font-mono">.../1/*))#checksum</span><br>
          <br>
          ⚠️ Colle-les <strong>sans les modifier</strong> (checksum inclus).
        </p>
      </div>

      <!-- RECEIVE -->
      <div>
        <%= f.label :receive_descriptor, "Receive descriptor (/0/*)", class: "block text-sm text-gray-300 mb-1" %>
        <%= f.text_area :receive_descriptor,
              rows: 5,
              class: "w-full rounded-md bg-gray-800 border border-gray-700 text-gray-100 px-3 py-2 text-xs font-mono",
              placeholder: "wsh(sortedmulti(2,[FPR/path]xpub.../0/*,[FPR/path]xpub.../0/*))#checksum" %>
      </div>

      <!-- CHANGE -->
      <div>
        <%= f.label :change_descriptor, "Change descriptor (/1/*)", class: "block text-sm text-gray-300 mb-1" %>
        <%= f.text_area :change_descriptor,
              rows: 5,
              class: "w-full rounded-md bg-gray-800 border border-gray-700 text-gray-100 px-3 py-2 text-xs font-mono",
              placeholder: "wsh(sortedmulti(2,[FPR/path]xpub.../1/*,[FPR/path]xpub.../1/*))#checksum" %>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="bg-gray-950/40 border border-gray-800 rounded-xl p-4">
          <p class="text-xs text-gray-400 mb-1">Type attendu</p>
          <p class="text-sm text-gray-100 font-semibold">P2WSH (wsh)</p>
          <p class="text-[11px] text-gray-500 mt-1">Multisig 2-of-2</p>
        </div>

        <div class="bg-gray-950/40 border border-gray-800 rounded-xl p-4">
          <p class="text-xs text-gray-400 mb-1">Wallet complet</p>
          <p class="text-sm text-gray-100 font-semibold font-mono">/0/* + /1/*</p>
          <p class="text-[11px] text-gray-500 mt-1">Receive + Change</p>
        </div>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="flex items-center gap-4">
      <%= f.submit "Importer le wallet",
            class: "px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold" %>

      <%= link_to "Annuler",
            vaults_path,
            class: "px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg" %>
    </div>

  <% end %>
</div>
